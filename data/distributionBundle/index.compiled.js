'use strict';
(function(j,k){'object'==typeof exports&&'object'==typeof module?module.exports=k(require('babel-runtime/core-js/promise'),require('babel-runtime/helpers/asyncToGenerator'),require('child_process'),require('clientnode'),function(){try{return require('source-map-support/register')}catch(m){}}()):'function'==typeof define&&define.amd?define('nginxwebnodeplugin',['babel-runtime/core-js/promise','babel-runtime/helpers/asyncToGenerator','child_process','clientnode','source-map-support/register'],k):'object'==typeof exports?exports.nginxwebnodeplugin=k(require('babel-runtime/core-js/promise'),require('babel-runtime/helpers/asyncToGenerator'),require('child_process'),require('clientnode'),function(){try{return require('source-map-support/register')}catch(m){}}()):j.nginxwebnodeplugin=k(j['babel-runtime/core-js/promise'],j['babel-runtime/helpers/asyncToGenerator'],j.child_process,j.clientnode,j['source-map-support/register'])})(this,function(g,j,k,l,m){return function(n){function o(q){if(p[q])return p[q].exports;var r=p[q]={i:q,l:!1,exports:{}};return n[q].call(r.exports,r,r.exports,o),r.l=!0,r.exports}var p={};return o.m=n,o.c=p,o.i=function(q){return q},o.d=function(q,r,s){o.o(q,r)||Object.defineProperty(q,r,{configurable:!1,enumerable:!0,get:s})},o.n=function(q){var r=q&&q.__esModule?function(){return q['default']}:function(){return q};return o.d(r,'a',r),r},o.o=function(q,r){return Object.prototype.hasOwnProperty.call(q,r)},o.p='',o(o.s=7)}([function(n,o,p){'use strict';(function(q){function r(A){return A&&A.__esModule?A:{default:A}}var s=p(2),t=r(s),u=p(3),v=r(u),w=p(4),x=p(5),y=r(x);o.__esModule=!0;try{p(6)}catch(A){}class z{static shouldExit(A,B){return(0,v.default)(function*(){return null!==A.nginx&&(A.nginx.kill('SIGINT'),yield z.checkReachability(B.server,!0)),delete A.nginx,A})()}static loadService(A,B,C){return(0,v.default)(function*(){if(!B.hasOwnProperty('nginx')){B.nginx=(0,w.spawn)('nginx',[],{cwd:q.cwd(),env:q.env,shell:!0,stdio:'inherit'});let D=new t.default(function(E,F){for(const G of y.default.closeEventNames)B.nginx.on(G,y.default.getProcessCloseHandler(E,C.server.proxy.optional?E:F,{reason:B.nginx,process:B.nginx}))});try{yield z.checkReachability(C.server)}catch(E){if(C.server.proxy.optional)console.warn(`Nginx couldn't be started but was marked as optional.`),B.nginx=null,D=null;else throw E}return{name:'nginx',promise:D}}return B.nginx})()}static checkReachability(A,B=!1,C=3){return(0,v.default)(function*(){if(0<A.proxy.ports.length){const D='http'+(443===A.proxy.ports[0]?'s':'')+`://`+`${A.application.hostName}:`+`${A.proxy.ports[0]}`;return yield B?y.default.checkUnreachability(D,!0):y.default.checkReachability(D,!0,200,C)}return{}})()}}o.default=z}).call(o,p(1))},function(n){function p(){throw new Error('setTimeout has not been defined')}function q(){throw new Error('clearTimeout has not been defined')}function r(E){if(y===setTimeout)return setTimeout(E,0);if((y===p||!y)&&setTimeout)return y=setTimeout,setTimeout(E,0);try{return y(E,0)}catch(F){try{return y.call(null,E,0)}catch(G){return y.call(this,E,0)}}}function s(E){if(z===clearTimeout)return clearTimeout(E);if((z===q||!z)&&clearTimeout)return z=clearTimeout,clearTimeout(E);try{return z(E)}catch(F){try{return z.call(null,E)}catch(G){return z.call(this,E)}}}function t(){B&&C&&(B=!1,C.length?A=C.concat(A):D=-1,A.length&&u())}function u(){if(!B){var E=r(t);B=!0;for(var F=A.length;F;){for(C=A,A=[];++D<F;)C&&C[D].run();D=-1,F=A.length}C=null,B=!1,s(E)}}function v(E,F){this.fun=E,this.array=F}function w(){}var x=n.exports={},y,z;(function(){try{y='function'==typeof setTimeout?setTimeout:p}catch(E){y=p}try{z='function'==typeof clearTimeout?clearTimeout:q}catch(E){z=q}})();var A=[],B=!1,C,D=-1;x.nextTick=function(E){var F=Array(arguments.length-1);if(1<arguments.length)for(var G=1;G<arguments.length;G++)F[G-1]=arguments[G];A.push(new v(E,F)),1!==A.length||B||r(u)},v.prototype.run=function(){this.fun.apply(null,this.array)},x.title='browser',x.browser=!0,x.env={},x.argv=[],x.version='',x.versions={},x.on=w,x.addListener=w,x.once=w,x.off=w,x.removeListener=w,x.removeAllListeners=w,x.emit=w,x.binding=function(){throw new Error('process.binding is not supported')},x.cwd=function(){return'/'},x.chdir=function(){throw new Error('process.chdir is not supported')},x.umask=function(){return 0}},function(n){n.exports=g},function(n){n.exports=j},function(n){n.exports=k},function(n){n.exports=l},function(n){if('undefined'==typeof m){var p=new Error('Cannot find module "source-map-support/register"');throw p.code='MODULE_NOT_FOUND',p}n.exports=m},function(n,o,p){n.exports=p(0)}])});